{% extends 'SyliusWebBundle:Backend:layout.html.twig' %}

{% block javascripts %}
{{ parent() }}
{% javascripts output='assets/compiled/backend_product.js'
    '//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js'
    '//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js'
    '@SyliusShippingBundle/Resources/assets/js/prototype-handler.js'
    '@SyliusWebBundle/Resources/assets/js/dynamic-property-types.js'
    '@PunkAveFileUploaderBundle/Resources/public/js/jquery.fileupload.js'
    '@PunkAveFileUploaderBundle/Resources/public/js/jquery.iframe-transport.js'
    '@PunkAveFileUploaderBundle/Resources/public/js/FileUploader.js'
%}
    <script type="text/javascript" src="{{ asset_url }}"></script>
{% endjavascripts %}
    <script type="text/javascript">
        $(function() {
            new PunkAveFileUploader({
                'uploadUrl': '{{ path('sylius_backend_product_upload', {'id': form.uploadId.vars.value}) }}',
                'el': '#product-multiple-images',
                'viewUrl': '{{ global_media_web_base_path ~ '/' ~ form.uploadId.vars.value }}',
                'existingFiles': {{ sylius_get_files(form.uploadId.vars.value)|json_encode|raw }}
            });

            $('#product-multiple-images-file').on('click drop', function() {
                $('#product-images').hide();
            });

            $('#sylius-assortment-product-images').sortable({
                update: function(event, ui) {
                    $('input[name^="sylius_product[masterVariant][images]"][name$="[position]"]').each(function(position, el) {
                        $(el).val(position);
                    });
                }
            });
        });
    </script>
{% endblock %}
